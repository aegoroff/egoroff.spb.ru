if(typeof RELANG=="undefined")var RELANG={};var RLANG={html:"HTML",video:"Insert Video...",image:"Insert Image...",table:"Table",link:"Link",link_insert:"Insert Link ...",unlink:"Unlink",formatting:"Formatting",paragraph:"Paragraph",quote:"Quote",code:"Code",header1:"Header 1",header2:"Header 2",header3:"Header 3",header4:"Header 4",bold:"Bold",italic:"Italic",fontcolor:"Font Color",backcolor:"Back Color",unorderedlist:"Unordered List",orderedlist:"Ordered List",outdent:"Outdent",indent:"Indent",cancel:"Cancel",insert:"Insert",save:"Save",_delete:"Delete",insert_table:"Insert Table...",insert_row_above:"Add Row Above",insert_row_below:"Add Row Below",insert_column_left:"Add Column Left",insert_column_right:"Add Column Right",delete_column:"Delete Column",delete_row:"Delete Row",delete_table:"Delete Table",rows:"Rows",columns:"Columns",add_head:"Add Head",delete_head:"Delete Head",title:"Title",image_position:"Position",none:"None",left:"Left",right:"Right",image_web_link:"Image Web Link",text:"Text",mailto:"Email",web:"URL",video_html_code:"Video Embed Code",file:"Insert File...",upload:"Upload",download:"Download",choose:"Choose",or_choose:"Or choose",drop_file_here:"Drop file here",align_left:"Align Left",align_center:"Align Center",align_right:"Align Right",align_justify:"Justify",horizontalrule:"Insert Horizontal Rule",fullscreen:"Fullscreen",deleted:"Deleted",anchor:"Anchor"};(function(e){"use strict";jQuery.fn.redactor=function(n){return this.each(function(){var r=e(this),i=r.data("redactor");i||r.data("redactor",i=new t(this,n))})};var t=function(t,n){this.$el=e(t),typeof n!="undefined"&&typeof n.lang!="undefined"&&n.lang!=="en"&&typeof RELANG[n.lang]!="undefined"&&(RLANG=RELANG[n.lang]),this.opts=e.extend({lang:"en",direction:"ltr",callback:!1,keyupCallback:!1,keydownCallback:!1,execCommandCallback:!1,path:!1,css:"style.css",focus:!1,resize:!0,autoresize:!1,fixed:!1,autoformat:!0,cleanUp:!0,removeStyles:!1,removeClasses:!1,convertDivs:!0,convertLinks:!0,xhtml:!1,handler:!1,autosave:!1,interval:60,imageGetJson:!1,imageUpload:!1,imageUploadCallback:!1,fileUpload:!1,fileUploadCallback:!1,observeImages:!0,visual:!0,fullscreen:!1,overlay:!0,buttonsCustom:{},buttonsAdd:[],buttons:["html","|","formatting","|","bold","italic","deleted","|","unorderedlist","orderedlist","outdent","indent","|","image","video","file","table","link","|","fontcolor","backcolor","|","alignleft","aligncenter","alignright","justify","|","horizontalrule","fullscreen"],colors:["#ffffff","#000000","#eeece1","#1f497d","#4f81bd","#c0504d","#9bbb59","#8064a2","#4bacc6","#f79646","#ffff00","#f2f2f2","#7f7f7f","#ddd9c3","#c6d9f0","#dbe5f1","#f2dcdb","#ebf1dd","#e5e0ec","#dbeef3","#fdeada","#fff2ca","#d8d8d8","#595959","#c4bd97","#8db3e2","#b8cce4","#e5b9b7","#d7e3bc","#ccc1d9","#b7dde8","#fbd5b5","#ffe694","#bfbfbf","#3f3f3f","#938953","#548dd4","#95b3d7","#d99694","#c3d69b","#b2a2c7","#b7dde8","#fac08f","#f2c314","#a5a5a5","#262626","#494429","#17365d","#366092","#953734","#76923c","#5f497a","#92cddc","#e36c09","#c09100","#7f7f7f","#0c0c0c","#1d1b10","#0f243e","#244061","#632423","#4f6128","#3f3151","#31859b","#974806","#7f6000"],allEmptyHtml:"<p><br /></p>",mozillaEmptyHtml:"<p>&nbsp;</p>",modal_file:String()+'<form id="redactorUploadFileForm" method="post" action="" enctype="multipart/form-data">'+"<label>Name (optional)</label>"+'<input type="text" id="redactor_filename" class="redactor_input" />'+'<div style="margin-top: 7px;">'+'<input type="file" id="redactor_file" name="file" />'+"</div>"+"</form>",modal_image_edit:String()+"<label>"+RLANG.title+"</label>"+'<input id="redactor_file_alt" class="redactor_input" />'+"<label>"+RLANG.link+"</label>"+'<input id="redactor_file_link" class="redactor_input" />'+"<label>"+RLANG.image_position+"</label>"+'<select id="redactor_form_image_align">'+'<option value="none">'+RLANG.none+"</option>"+'<option value="left">'+RLANG.left+"</option>"+'<option value="right">'+RLANG.right+"</option>"+"</select>"+'<div id="redactor_modal_footer">'+'<a href="javascript:void(null);" id="redactor_image_delete_btn" style="color: #000;">'+RLANG._delete+"</a>"+'<span class="redactor_btns_box">'+'<input type="button" name="save" id="redactorSaveBtn" value="'+RLANG.save+'" />'+'<a href="javascript:void(null);" id="redactor_btn_modal_close">'+RLANG.cancel+"</a>"+"</span>"+"</div>",modal_image:String()+'<div id="redactor_tabs">'+'<a href="javascript:void(null);" class="redactor_tabs_act">'+RLANG.upload+"</a>"+'<a href="javascript:void(null);">'+RLANG.choose+"</a>"+'<a href="javascript:void(null);">'+RLANG.link+"</a>"+"</div>"+'<form id="redactorInsertImageForm" method="post" action="" enctype="multipart/form-data">'+'<div id="redactor_tab1" class="redactor_tab">'+'<input type="file" id="redactor_file" name="file" />'+"</div>"+'<div id="redactor_tab2" class="redactor_tab" style="display: none;">'+'<div id="redactor_image_box"></div>'+"</div>"+"</form>"+'<div id="redactor_tab3" class="redactor_tab" style="display: none;">'+"<label>"+RLANG.image_web_link+"</label>"+'<input name="redactor_file_link" id="redactor_file_link" class="redactor_input"  />'+"</div>"+'<div id="redactor_modal_footer">'+'<span class="redactor_btns_box">'+'<input type="button" name="upload" id="redactor_upload_btn" value="'+RLANG.insert+'" />'+'<a href="javascript:void(null);" id="redactor_btn_modal_close">'+RLANG.cancel+"</a>"+"</span>"+"</div>",modal_link:String()+'<form id="redactorInsertLinkForm" method="post" action="">'+'<div id="redactor_tabs">'+'<a href="javascript:void(null);" class="redactor_tabs_act">URL</a>'+'<a href="javascript:void(null);">Email</a>'+'<a href="javascript:void(null);">'+RLANG.anchor+"</a>"+"</div>"+'<input type="hidden" id="redactor_tab_selected" value="1" />'+'<div class="redactor_tab" id="redactor_tab1">'+'<label>URL</label><input id="redactor_link_url" class="redactor_input"  />'+"<label>"+RLANG.text+'</label><input class="redactor_input redactor_link_text" id="redactor_link_url_text" />'+"</div>"+'<div class="redactor_tab" id="redactor_tab2" style="display: none;">'+'<label>Email</label><input id="redactor_link_mailto" class="redactor_input" />'+"<label>"+RLANG.text+'</label><input class="redactor_input redactor_link_text" id="redactor_link_mailto_text" />'+"</div>"+'<div class="redactor_tab" id="redactor_tab3" style="display: none;">'+"<label>"+RLANG.anchor+'</label><input class="redactor_input" id="redactor_link_anchor"  />'+"<label>"+RLANG.text+'</label><input class="redactor_input redactor_link_text" id="redactor_link_anchor_text" />'+"</div>"+"</form>"+'<div id="redactor_modal_footer">'+'<span class="redactor_btns_box">'+'<input type="button" id="redactor_insert_link_btn" value="'+RLANG.insert+'" />'+'<a href="javascript:void(null);" id="redactor_btn_modal_close">'+RLANG.cancel+"</a>"+"</span>"+"</div>",modal_table:String()+"<label>"+RLANG.rows+"</label>"+'<input size="5" value="2" id="redactor_table_rows" />'+"<label>"+RLANG.columns+"</label>"+'<input size="5" value="3" id="redactor_table_columns" />'+'<div id="redactor_modal_footer">'+'<span class="redactor_btns_box">'+'<input type="button" name="upload" id="redactor_insert_table_btn" value="'+RLANG.insert+'" />'+'<a href="javascript:void(null);" id="redactor_btn_modal_close">'+RLANG.cancel+"</a>"+"</span>"+"</div>",modal_video:String()+'<form id="redactorInsertVideoForm">'+"<label>"+RLANG.video_html_code+"</label>"+'<textarea id="redactor_insert_video_area" style="width: 99%; height: 160px;"></textarea>'+"</form>"+'<div id="redactor_modal_footer">'+'<span class="redactor_btns_box">'+'<input type="button" id="redactor_insert_video_btn" value="'+RLANG.insert+'" />'+'<a href="javascript:void(null);" id="redactor_btn_modal_close">'+RLANG.cancel+"</a>"+"</span>"+"</div>",toolbar:{html:{title:RLANG.html,func:"toggle"},formatting:{title:RLANG.formatting,func:"show",dropdown:{p:{title:RLANG.paragraph,exec:"formatblock"},blockquote:{title:RLANG.quote,exec:"formatblock",className:"redactor_format_blockquote"},pre:{title:RLANG.code,exec:"formatblock",className:"redactor_format_pre"},h1:{title:RLANG.header1,exec:"formatblock",className:"redactor_format_h1"},h2:{title:RLANG.header2,exec:"formatblock",className:"redactor_format_h2"},h3:{title:RLANG.header3,exec:"formatblock",className:"redactor_format_h3"},h4:{title:RLANG.header4,exec:"formatblock",className:"redactor_format_h4"}}},bold:{title:RLANG.bold,exec:"bold"},italic:{title:RLANG.italic,exec:"italic"},deleted:{title:RLANG.deleted,exec:"strikethrough"},unorderedlist:{title:"&bull; "+RLANG.unorderedlist,exec:"insertunorderedlist"},orderedlist:{title:"1. "+RLANG.orderedlist,exec:"insertorderedlist"},outdent:{title:"< "+RLANG.outdent,exec:"outdent"},indent:{title:"> "+RLANG.indent,exec:"indent"},image:{title:RLANG.image,func:"showImage"},video:{title:RLANG.video,func:"showVideo"},file:{title:RLANG.file,func:"showFile"},table:{title:RLANG.table,func:"show",dropdown:{insert_table:{title:RLANG.insert_table,func:"showTable"},separator_drop1:{name:"separator"},insert_row_above:{title:RLANG.insert_row_above,func:"insertRowAbove"},insert_row_below:{title:RLANG.insert_row_below,func:"insertRowBelow"},insert_column_left:{title:RLANG.insert_column_left,func:"insertColumnLeft"},insert_column_right:{title:RLANG.insert_column_right,func:"insertColumnRight"},separator_drop2:{name:"separator"},add_head:{title:RLANG.add_head,func:"addHead"},delete_head:{title:RLANG.delete_head,func:"deleteHead"},separator_drop3:{name:"separator"},delete_column:{title:RLANG.delete_column,func:"deleteColumn"},delete_row:{title:RLANG.delete_row,func:"deleteRow"},delete_table:{title:RLANG.delete_table,func:"deleteTable"}}},link:{title:RLANG.link,func:"show",dropdown:{link:{title:RLANG.link_insert,func:"showLink"},unlink:{title:RLANG.unlink,exec:"unlink"}}},fontcolor:{title:RLANG.fontcolor,func:"show"},backcolor:{title:RLANG.backcolor,func:"show"},alignleft:{exec:"JustifyLeft",title:RLANG.align_left},aligncenter:{exec:"JustifyCenter",title:RLANG.align_center},alignright:{exec:"JustifyRight",title:RLANG.align_right},justify:{exec:"justifyfull",title:RLANG.align_justify},horizontalrule:{exec:"inserthorizontalrule",title:RLANG.horizontalrule},fullscreen:{title:RLANG.fullscreen,func:"fullscreen"}}},n,this.$el.data()),this.dropdowns=[],this.init()};t.prototype={init:function(){this.getPath(),this.opts.toolbar!==!1&&(e.extend(this.opts.toolbar,this.opts.buttonsCustom),e.each(this.opts.buttonsAdd,e.proxy(function(e,t){this.opts.buttons.push(t)},this))),this.height=this.$el.css("height"),this.width=this.$el.css("width"),this.build();var t=this.$el.val();t=this.preformater(t),this.opts.autoformat&&(t=this.paragraphy(t)),this.$editor=this.enable(t),this.observeFocus(),this.opts.cleanUp===!0&&e(this.doc).bind("paste",e.proxy(function(t){setTimeout(e.proxy(function(){var t=Math.floor(Math.random()*99999),n="";e.support.mozilla&&(n="&nbsp;");var r=e('<span rel="pastemarkerend" id="pastemarkerend'+t+'">'+n+"</span>");this.insertNodeAtCaret(r.get(0)),this.pasteCleanUp(t)},this),100)},this)),e(this.doc).keyup(e.proxy(function(e){var t=e.keyCode||e.which;typeof this.opts.keyupCallback=="function"&&this.opts.keyupCallback(this,e);if(this.opts.autoformat){if(t===8||t===46)return this.formatEmpty(e);if(t===13&&!e.shiftKey&&!e.ctrlKey&&!e.metaKey)return this.formatNewLine(e)}this.syncCode()},this)),this.buildToolbar(),this.opts.autoresize===!1?this.buildResizer():this.observeAutoResize(),this.shortcuts(),this.autoSave(),this.observeImages(),this.observeTables(),this.opts.fullscreen&&(this.opts.fullscreen=!1,this.fullscreen()),this.opts.focus&&this.focus(),this.opts.fixed&&(this.observeScroll(),e(document).scroll(e.proxy(this.observeScroll,this))),typeof this.opts.callback=="function"&&this.opts.callback(this)},shortcuts:function(){e(this.doc).keydown(e.proxy(function(t){var n=t.keyCode||t.which;typeof this.opts.keydownCallback=="function"&&this.opts.keydownCallback(this,t),t.ctrlKey&&(n===90?this._shortcuts(t,"undo"):n===90&&t.shiftKey?this._shortcuts(t,"redo"):n===77?this._shortcuts(t,"removeFormat"):n===66?this._shortcuts(t,"bold"):n===73?this._shortcuts(t,"italic"):n===74?this._shortcuts(t,"insertunorderedlist"):n===75?this._shortcuts(t,"insertorderedlist"):n===76?this._shortcuts(t,"superscript"):n===72&&this._shortcuts(t,"subscript")),!t.shiftKey&&n===9?this._shortcuts(t,"indent"):t.shiftKey&&n===9&&this._shortcuts(t,"outdent");if(e.support.webkit&&navigator.userAgent.indexOf("Chrome")===-1)return this.safariShiftKeyEnter(t,n)},this))},_shortcuts:function(e,t){e.preventDefault&&e.preventDefault(),this.execCommand(t,!1)},getPath:function(){if(this.opts.path!==!1)return this.opts.path;e("script").each(e.proxy(function(e,t){if(t.src){var n=new RegExp(/\/redactor(\.min)?\.js(\?.*)?/);t.src.match(n)&&(this.opts.path=t.src.replace(n,""))}},this))},build:function(){this.$box=e('<div class="redactor_box"></div>'),this.$frame=e('<iframe frameborder="0" scrolling="auto" style="height: '+this.height+';" class="redactor_frame"></iframe>'),this.$el.css("width","100%").hide(),this.$box.insertAfter(this.$el).append(this.$frame).append(this.$el)},write:function(e){this.doc.open(),this.doc.write(e),this.doc.close()},enable:function(t){return this.doc=this.getDoc(this.$frame.get(0)),this.doc!==null?(this.write(this.setDoc(t)),e(this.doc).find("#page")):!1},setDoc:function(e){var t='<!DOCTYPE html>\n<html><head><link media="all" type="text/css" href="'+this.opts.path+"/css/"+this.opts.css+'" rel="stylesheet"></head>'+'<body><div id="page" contenteditable="true" dir="'+this.opts.direction+'">'+e+"</div></body></html>";return t},getDoc:function(e){return e.contentDocument?e.contentDocument:e.contentWindow&&e.contentWindow.document?e.contentWindow.document:e.document?e.document:null},focus:function(){this.$editor.focus()},syncCode:function(){var e=this.formatting(this.$editor.html());this.$el.val(e)},setCode:function(e){e=this.preformater(e),this.$editor.html(e).focus(),this.syncCode()},getCode:function(){var e=this.$editor?this.$editor.html():this.$el.val();return e=this.reformater(e),e},insertHtml:function(e){this.execCommand("inserthtml",e),this.observeImages()},destroy:function(){var e=this.getCode();this.$box.after(this.$el),this.$box.remove(),this.$el.val(e).show();for(var t=0;t<this.dropdowns.length;t++)this.dropdowns[t].remove(),delete this.dropdowns[t]},handler:function(){e.ajax({url:this.opts.handler,type:"POST",data:"redactor="+escape(encodeURIComponent(this.getCode())),success:e.proxy(function(e){this.setCode(e),this.syncCode()},this)})},observeFocus:function(){if(e.support.msie)return!1;e(this.doc).find("body").height()<e(this.$frame.get(0).contentWindow).height()&&e(this.doc).click(e.proxy(function(e){this.$editor.focus()},this))},observeImages:function(){if(this.opts.observeImages===!1)return!1;e(this.doc).find("img").each(e.proxy(function(t,n){e.support.msie&&e(n).attr("unselectable","on"),this.resizeImage(n)},this))},observeTables:function(){e(this.doc).find("body").find("table").click(e.proxy(this.tableObserver,this))},observeScroll:function(){var t=e(document).scrollTop(),n=this.$box.offset().top;t>n?(this.fixed=!0,this.$toolbar.css({position:"fixed",width:"100%"})):(this.fixed=!1,this.$toolbar.css({position:"relative",width:"auto"}))},observeAutoResize:function(){this.$editor.css({"min-height":this.$el.height()+"px"}),e(this.doc).find("body").css({overflow:"hidden"}),this.setAutoSize(!1),e(this.doc).keyup(e.proxy(this.setAutoSize,this))},setAutoSize:function(e){var t=!1;e!==!1&&(t=e.keyCode||e.which);var n=this.$editor.outerHeight(!0);e!==!0||t!==8&&t!==46?this.$frame.height(n+30):this.$frame.height(n)},execCommand:function(t,n){if(this.opts.visual&&this.doc)try{e.support.msie&&this.focus(),t==="inserthtml"&&e.support.msie?this.doc.selection.createRange().pasteHTML(n):t==="formatblock"&&e.support.msie?this.doc.execCommand(t,!1,"<"+n+">"):this.doc.execCommand(t,!1,n),this.syncCode(),this.focus(),typeof this.opts.execCommandCallback=="function"&&this.opts.execCommandCallback(this,t)}catch(r){}},formatNewLine:function(t){var n=this.getParentNode();if(n.nodeName!=="DIV"||n.id!=="page")return this.syncCode(),!0;t.preventDefault&&t.preventDefault();var r=e(this.getCurrentNode());if(r.get(0).tagName==="DIV"&&(r.html()===""||r.html()==="<br>")){var i=e("<p>").append(r.clone().get(0).childNodes);return r.replaceWith(i),i.html("<br />"),this.setFocusNode(i.get(0)),this.syncCode(),!1}this.syncCode(),this.opts.convertLinks&&this.$editor.linkify()},safariShiftKeyEnter:function(t,n){if(t.shiftKey&&n===13){t.preventDefault();var r=e("<span><br /></span>");return this.insertNodeAtCaret(r.get(0)),this.setFocusNode(r.get(0)),this.syncCode(),!1}return!0},formatEmpty:function(t){var n=e.trim(this.$editor.html());e.support.mozilla&&(n=n.replace(/<br>/gi,""));if(n===""){t.preventDefault&&t.preventDefault();var r=this.opts.allEmptyHtml;e.support.mozilla&&(r=this.opts.mozillaEmptyHtml);var i=e(r).get(0);return this.$editor.html(i),this.setFocusNode(i),this.syncCode(),!1}this.syncCode()},paragraphy:function(t){t=e.trim(t);if(t==="")return e.support.mozilla?this.opts.mozillaEmptyHtml:this.opts.allEmptyHtml;this.opts.convertDivs&&(t=t.replace(/<div(.*?)>([\w\W]*?)<\/div>/gi,"<p>$2</p>"));var n=function(e,t,n){return e.replace(new RegExp(t,"g"),n)},r=function(e,r){return n(t,e,r)},i="(table|thead|tfoot|caption|colgroup|tbody|tr|td|th|div|dl|dd|dt|ul|ol|li|pre|select|form|blockquote|address|math|style|script|object|input|param|p|h[1-6])";return t+="\n",r("<br />\\s*<br />","\n\n"),r("(<"+i+"[^>]*>)","\n$1"),r("(</"+i+">)","$1\n\n"),r("\r\n|\r","\n"),r("\n\n+","\n\n"),r("\n?((.|\n)+?)$","<p>$1</p>\n"),r("<p>\\s*?</p>",""),r("<p>(<div[^>]*>\\s*)","$1<p>"),r("<p>([^<]+)\\s*?(</(div|address|form)[^>]*>)","<p>$1</p>$2"),r("<p>\\s*(</?"+i+"[^>]*>)\\s*</p>","$1"),r("<p>(<li.+?)</p>","$1"),r("<p>\\s*(</?"+i+"[^>]*>)","$1"),r("(</?"+i+"[^>]*>)\\s*</p>","$1"),r("(</?"+i+"[^>]*>)\\s*<br />","$1"),r("<br />(\\s*</?(p|li|div|dl|dd|dt|th|pre|td|ul|ol)[^>]*>)","$1"),t.indexOf("<pre")!=-1&&r("(<pre(.|\n)*?>)((.|\n)*?)</pre>",function(e,t,r,i){return n(t,"\\\\(['\"\\\\])","$1")+n(n(n(i,"<p>","\n"),"</p>|<br />",""),"\\\\(['\"\\\\])","$1")+"</pre>"}),r("\n</p>$","</p>")},preformater:function(e){return e!==null?(e=e.replace(/<br>/gi,"<br />"),e=e.replace(/<strong\b[^>]*>([\w\W]*?)<\/strong[^>]*>/gi,"<b>$1</b>"),e=e.replace(/<em\b[^>]*>([\w\W]*?)<\/em[^>]*>/gi,"<i>$1</i>"),e=e.replace(/<del\b[^>]*>([\w\W]*?)<\/del[^>]*>/gi,"<strike>$1</strike>")):e="",e},reformater:function(e){return e=e.replace(/<br>/gi,"<br />"),e=e.replace(/<b\b[^>]*>([\w\W]*?)<\/b[^>]*>/gi,"<strong>$1</strong>"),e=e.replace(/<i\b[^>]*>([\w\W]*?)<\/i[^>]*>/gi,"<em>$1</em>"),e=e.replace(/<strike\b[^>]*>([\w\W]*?)<\/strike[^>]*>/gi,"<del>$1</del>"),e=e.replace(/<span(.*?)style="font-weight: bold;">([\w\W]*?)<\/span>/gi,"<strong>$2</strong>"),e=e.replace(/<span(.*?)style="font-style: italic;">([\w\W]*?)<\/span>/gi,"<em>$2</em>"),e=e.replace(/<span(.*?)style="font-weight: bold; font-style: italic;">([\w\W]*?)<\/span>/gi,"<em><strong>$2</strong></em>"),e=e.replace(/<span(.*?)style="font-style: italic; font-weight: bold;">([\w\W]*?)<\/span>/gi,"<strong><em>$2</em></strong>"),e},stripTags:function(t){var n=["code","span","div","label","a","br","p","b","i","del","strike","img","video","audio","iframe","object","embed","param","blockquote","mark","cite","small","ul","ol","li","hr","dl","dt","dd","sup","sub","big","pre","code","figure","figcaption","strong","em","table","tr","td","th","tbody","thead","tfoot","h1","h2","h3","h4","h5","h6"],r=/<\/?([a-z][a-z0-9]*)\b[^>]*>/gi;return t.replace(r,function(t,r){return e.inArray(r.toLowerCase(),n)>"-1"?t:""})},cleanStyles:function(t,n,r){var i=r.split("="),s=i[1].split(";"),o="";return e.each(s,function(n,r){if(typeof r=="undefined")return!0;if(r=='"'||r=="'")return!0;r=r.replace(/(^"|^')/,"").replace(/("$|'$)/,"").replace(/"(.*?)"/gi,""),r=e.trim(r);var i=r.split(":");typeof i[1]!="undefined"&&i[1].search("pt")===-1&&i[1].search("cm")===-1&&e.inArray(e.trim(i[0]),t)!="-1"&&(o+=r+"; ")}),n.replace(r,'style="'+o+'"')},pasteCleanUp:function(t){var n=this.$editor.html();n=n.replace(/<!--[\s\S]*?-->|<\?(?:php)?[\s\S]*?\?>/gi,""),n=this.formattingRemove(n),n=this.stripTags(n),this.opts.removeClasses?n=n.replace(/ class="([\w\W]*?)"/gi,""):(n=n.replace(/\s*class="TOC(.*?)"/gi,""),n=n.replace(/\s*class="Heading(.*?)"/gi,""),n=n.replace(/\s*class="Body(.*?)"/gi,""),n=n.replace(/\sclass="Nonformat"/gi,""),n=n.replace(/\sclass="Mso(.*?)"/gi,""),n=n.replace(/\sclass="Apple(.*?)"/gi,""),n=n.replace(/"Times New Roman"/gi,""));var r=["width","height","src","style","href","frameborder","class","id","rel","unselectable"],i=["color","background-color","font-style","margin","margin-top","margin-bottom","margin-left","margin-right","text-align","width","height","cursor","float"],s=n.match(/([\w\-.:]+)\s*=\s*("[^"]*"|'[^']*'|[\w\-.:]+)/gi);e.each(s,e.proxy(function(t,s){var o=s.split("=");e.inArray(o[0],r)=="-1"&&(n=n.replace(s,"")),this.opts.removeStyles===!1&&o[0]=="style"&&(n=this.cleanStyles(i,n,s))},this)),this.opts.removeStyles===!1?(n=n.replace(/background-color:(\s+)transparent;\s/gi,""),n=n.replace(/font-style:(\s+)normal;\s/gi,"")):n=n.replace(/ style="([\w\W]*?)"/gi,""),n=n.replace(/((\s{2,})?|\s)style=(""|'')/gi,""),n=n.replace(/(&nbsp;){1,}/gi,"&nbsp;"),n=n.replace(/<span(\s)?>(\s)?<\/span>/gi," "),n=n.replace(/\s{2,}/g," "),n=n.replace(/<span>([\w\W]*?)<\/span>/gi,"$1"),n=n.replace(/<span>([\w\W]*?)<\/span>/gi,"$1"),n=n.replace(/<span(\s)?>([\w\W]*?)<\/span>/gi,"$2"),n=this.formattingEmptyTags(n),n=this.formattingAddBefore(n),n=this.formattingAddAfter(n),n=this.formattingIndenting(n),n=n.replace(/<p><div>/gi,""),n=n.replace(/<p>\s+\n+<(.*?)/gi,"<$1"),n=n.replace(/<\/(.*?)>\s+\n+<\/p>/gi,"</$1>"),n=n.replace(/<p style="(.*?)">(\s)?<\/p>/gi,""),n=n.replace(/<p style="(.*?)"><\/p>/gi,""),n=n.replace(/<b\sid="internal-source-marker(.*?)">([\w\W]*?)<\/b>/gi,"$2"),n=n.replace(/; ">/gi,';">'),this.$editor.html(n);var o=e(this.doc.body).find("#pastemarkerend"+t).get(0);this.setFocusNode(o),this.syncCode(),setTimeout(e.proxy(function(){e(this.doc.body).find("span[rel=pastemarkerend]").remove(),this.opts.autoresize===!0&&this.setAutoSize(!1),this.observeImages(),this.observeTables()},this),100)},formattingRemove:function(e){return e=e.replace(/\s{2,}/g," "),e=e.replace(/\n/g," "),e=e.replace(/[\t]*/g,""),e=e.replace(/\n\s*\n/g,"\n"),e=e.replace(/^[\s\n]*/g,""),e=e.replace(/[\s\n]*$/g,""),e=e.replace(/>\s+</g,"><"),e},formattingIndenting:function(e){return e=e.replace(/<li/g,"	<li"),e=e.replace(/<tr/g,"	<tr"),e=e.replace(/<td/g,"		<td"),e=e.replace(/<\/tr>/g,"	</tr>"),e},formattingEmptyTags:function(e){var t=["<pre></pre>","<blockquote>\\s*</blockquote>","<em>\\s*</em>","<ul></ul>","<ol></ol>","<li></li>","<table></table>","<tr></tr>","<span>\\s*<span>","<span>&nbsp;<span>","<b>\\s*</b>","<b>&nbsp;</b>","<p>\\s*</p>","<p>&nbsp;</p>","<p>\\s*<br>\\s*</p>","<div>\\s*</div>","<div>\\s*<br>\\s*</div>"];for(var n=0;n<t.length;++n){var r=t[n];e=e.replace(new RegExp(r,"gi"),"")}return e},formattingAddBefore:function(e){var t="\r\n",n=["<p","<form","</ul>","</ol>","<fieldset","<legend","<object","<embed","<select","<option","<input","<textarea","<pre","<blockquote","<ul","<ol","<li","<dl","<dt","<dd","<table","<thead","<tbody","<caption","</caption>","<th","<tr","<td","<figure"];for(var r=0;r<n.length;++r){var i=n[r];e=e.replace(new RegExp(i,"gi"),t+i)}return e},formattingAddAfter:function(e){var t="\r\n",n=["</p>","</div>","</h1>","</h2>","</h3>","</h4>","</h5>","</h6>","<br>","<br />","</dl>","</dt>","</dd>","</form>","</blockquote>","</pre>","</legend>","</fieldset>","</object>","</embed>","</textarea>","</select>","</option>","</table>","</thead>","</tbody>","</tr>","</td>","</th>","</figure>"];for(var r=0;r<n.length;++r){var i=n[r];e=e.replace(new RegExp(i,"gi"),i+t)}return e},formatting:function(t){if(e.support.msie){var n=t.match(/<(.*?)>/gi);e.each(n,function(e,n){t=t.replace(n,n.toLowerCase())}),t=t.replace(/style="(.*?)"/gi,function(e){return e.toLowerCase()}),t=t.replace(/ jQuery(.*?)=\"(.*?)\"/gi,"")}return t=t.replace(/<span([\w\W]*?)style="color:(.*?);"><span([\w\W]*?)style="background-color:(.*?);">([\w\W]*?)<\/span><\/span>/gi,'<span style="color: $2; background-color: $4;">$5</span>'),t=t.replace(/<span([\w\W]*?)style="background-color:(.*?);"><span([\w\W]*?)style="color:(.*?);">([\w\W]*?)<\/span><\/span>/gi,'<span style="color: $2; background-color: $4;">$5</span>'),t=t.replace(/<span([\w\W]*?)color="(.*?)">([\w\W]*?)<\/span\>/gi,'<span$1style="color: $2;">$3</span>'),t=t.replace(/<font([\w\W]*?)color="(.*?)">([\w\W]*?)<\/font\>/gi,'<span$1style="color: $2;">$3</span>'),t=t.replace(/<span style="(.*?)"\s+style="(.*?)"[\s]*>([\w\W]*?)<\/span\>/gi,'<span style="$1;$2">$3</span>'),t=t.replace(/<font([\w\W]*?)>([\w\W]*?)<\/font\>/gi,"<span$1>$2</span>"),t=t.replace(/<span>([\w\W]*?)<\/span>/gi,"$1"),this.opts.xhtml&&(t=t.replace(/<br>/gi,"<br />"),t=t.replace(/<br ?\/?>$/gi,""),t=t.replace(/^<br ?\/?>/gi,""),t=t.replace(/(<img [^>]+[^\/])>/gi,"$1 />")),t=t.replace(/<p><p>/g,"<p>"),t=t.replace(/<\/p><\/p>/g,"</p>"),t=t.replace(/<hr(.*?)>/g,"<hr />"),t=t.replace(/<p>&nbsp;/g,"<p>"),t=t.replace(/<p><ul>/g,"<ul>"),t=t.replace(/<p><ol>/g,"<ol>"),t=t.replace(/<\/ul><\/p>/g,"</ul>"),t=t.replace(/<\/ol><\/p>/g,"</ol>"),t=t.replace(/<p(.*?)>&nbsp;<\/p>/gi,""),t=this.formattingRemove(t),t=this.formattingEmptyTags(t),t=this.formattingAddBefore(t),t=this.formattingAddAfter(t),t=this.formattingIndenting(t),t},toggle:function(){var t;this.opts.visual?(this.$frame.hide(),t=this.$editor.html(),t=e.trim(this.formatting(t)),this.$el.val(t).show().focus(),this.setBtnActive("html"),this.opts.visual=!1):(this.$el.hide(),this.$editor.html(this.$el.val()),this.$frame.show(),this.$editor.html()===""&&(e.support.mozilla?t=this.opts.mozillaEmptyHtml:t=this.opts.allEmptyHtml,this.setCode(t)),this.focus(),this.setBtnInactive("html"),this.opts.visual=!0,this.observeImages(),this.observeTables(),this.opts.autoresize===!0&&this.setAutoSize(!1))},autoSave:function(){if(this.opts.autosave===!1)return!1;setInterval(e.proxy(function(){e.post(this.opts.autosave,{data:this.getCode()})},this),this.opts.interval*1e3)},buildToolbar:function(){if(this.opts.toolbar===!1)return!1;this.$toolbar=e("<ul>").addClass("redactor_toolbar"),this.$box.prepend(this.$toolbar),e.each(this.opts.buttons,e.proxy(function(t,n){if(n!=="|"&&typeof this.opts.toolbar[n]!="undefined"){var r=this.opts.toolbar[n];if(this.opts.fileUpload===!1&&n==="file")return!0;var i=e("<li>");n==="fullscreen"&&e(i).addClass("redactor_toolbar_right");var s=this.buildButton(n,r);if(n==="backcolor"||n==="fontcolor"||typeof r.dropdown!="undefined"){var o=e('<div class="redactor_dropdown" style="display: none;">');n==="backcolor"||n==="fontcolor"?o=this.buildColorPicker(o,n):o=this.buildDropdown(o,r.dropdown),this.dropdowns.push(o.appendTo(e(document.body))),this.hdlHideDropDown=e.proxy(function(e){this.hideDropDown(e,o,n)},this),this.hdlShowDropDown=e.proxy(function(e){this.showDropDown(e,o,n)},this),s.click(this.hdlShowDropDown)}this.$toolbar.append(e(i).append(s))}n==="|"&&this.$toolbar.append(e('<li class="redactor_separator"></li>'))},this)),e(document).click(this.hdlHideDropDown),e(this.doc).click(this.hdlHideDropDown)},buildButton:function(t,n){var r=e('<a href="javascript:void(null);" title="'+n.title+'" class="redactor_btn_'+t+'"><span>&nbsp;</span></a>');return typeof n.func=="undefined"?r.click(e.proxy(function(){this.execCommand(n.exec,t)},this)):n.func!=="show"&&r.click(e.proxy(function(e){this[n.func](e)},this)),typeof n.callback!="undefined"&&r.click(e.proxy(function(e){n.callback(this,e,t)},this)),r},buildDropdown:function(t,n){return e.each(n,e.proxy(function(n,r){typeof r.className=="undefined"&&(r.className="");var i;typeof r.name!="undefined"&&r.name==="separator"?i=e('<a class="redactor_separator_drop">'):(i=e('<a href="javascript:void(null);" class="'+r.className+'">'+r.title+"</a>"),typeof r.func=="undefined"?e(i).click(e.proxy(function(){this.execCommand(r.exec,n)},this)):e(i).click(e.proxy(function(e){this[r.func](e)},this))),e(t).append(i)},this)),t},buildColorPicker:function(t,n){var r;n==="backcolor"?e.support.msie?r="BackColor":r="hilitecolor":r="forecolor",e(t).width(210);var i=this.opts.colors.length;for(var s=0;s<i;++s){var o=this.opts.colors[s],u=e('<a rel="'+o+'" href="javascript:void(null);" class="redactor_color_link"></a>').css({backgroundColor:o});e(t).append(u);var a=this;e(u).click(function(){a.execCommand(r,e(this).attr("rel"))})}var f=e('<a href="javascript:void(null);" class="redactor_color_none"></a>').html(RLANG.none);return n==="backcolor"?f.click(e.proxy(this.setBackgroundNone,this)):f.click(e.proxy(this.setColorNone,this)),e(t).append(f),t},setBackgroundNone:function(){e(this.getParentNode()).css("background-color","transparent"),this.syncCode()},setColorNone:function(){e(this.getParentNode()).attr("color","").css("color",""),this.syncCode()},showDropDown:function(t,n,r){if(this.getBtn(r).hasClass("dropact"))this.hideAllDropDown();else{this.hideAllDropDown(),this.setBtnActive(r),this.getBtn(r).addClass("dropact");var i=this.getBtn(r).offset().left;if(this.opts.fixed&&this.fixed)e(n).css({position:"fixed",left:i+"px",top:"30px"}).show();else{var s=this.$toolbar.offset().top+30;e(n).css({position:"absolute",left:i+"px",top:s+"px"}).show()}}},hideAllDropDown:function(){this.$toolbar.find("a.dropact").removeClass("act").removeClass("dropact"),e(".redactor_dropdown").hide()},hideDropDown:function(t,n,r){e(t.target).parent().hasClass("dropact")||(e(n).removeClass("act"),this.showedDropDown=!1,this.hideAllDropDown())},getSelection:function(){if(this.$frame.get(0).contentWindow.getSelection)return this.$frame.get(0).contentWindow.getSelection();if(this.$frame.get(0).contentWindow.document.selection)return this.$frame.get(0).contentWindow.document.selection.createRange()},getParentNode:function(){if(window.getSelection)return this.getSelection().getRangeAt(0).startContainer.parentNode;if(document.selection)return this.getSelection().parentElement()},getCurrentNode:function(){if(window.getSelection)return this.getSelection().getRangeAt(0).startContainer;if(document.selection)return this.getSelection()},setFocusNode:function(e,t){var n=this.doc.createRange(),r=this.getSelection();t=t?0:1,r!==null&&(n.selectNodeContents(e),r.addRange(n),r.collapse(e,t)),this.focus()},insertNodeAtCaret:function(e){if(typeof window.getSelection!="undefined"){var t=this.getSelection();if(t.rangeCount){var n=t.getRangeAt(0);n.collapse(!1),n.insertNode(e),n=n.cloneRange(),n.selectNodeContents(e),n.collapse(!1),t.removeAllRanges(),t.addRange(n)}}else if(typeof document.selection!="undefined"&&document.selection.type!=="Control"){var r=e.nodeType===1?e.outerHTML:e.data,i="marker_"+(""+Math.random()).slice(2);r+='<span id="'+i+'"></span>';var s=this.getSelection();s.collapse(!1),s.pasteHTML(r);var o=document.getElementById(i);s.moveToElementText(o),s.select(),o.parentNode.removeChild(o)}},getBtn:function(t){return e(this.$toolbar.find("a.redactor_btn_"+t))},setBtnActive:function(e){this.getBtn(e).addClass("act")},setBtnInactive:function(e){this.getBtn(e).removeClass("act")},changeBtnIcon:function(e,t){this.getBtn(e).addClass("redactor_btn_"+t)},removeBtnIcon:function(e,t){this.getBtn(e).removeClass("redactor_btn_"+t)},removeBtn:function(e){this.getBtn(e).remove()},addBtn:function(t,n){this.$toolbar.append(e("<li>").append(this.buildButton(t,n)))},fullscreen:function(){var t;this.opts.fullscreen===!1?(this.changeBtnIcon("fullscreen","normalscreen"),this.setBtnActive("fullscreen"),this.opts.fullscreen=!0,this.height=this.$frame.css("height"),this.width=this.$box.width()-2+"px",t=this.getCode(),this.tmpspan=e("<span></span>"),this.$box.addClass("redactor_box_fullscreen").after(this.tmpspan),e(document.body).prepend(this.$box).css("overflow","hidden"),this.$editor=this.enable(t),e(this.doc).click(e.proxy(this.hideAllDropDown,this)),this.observeFocus(),this.observeImages(),this.observeTables(),this.$box.find(".redactor_resizer").hide(),this.fullScreenResize(),e(window).resize(e.proxy(this.fullScreenResize,this)),e(document).scrollTop(0,0),this.focus()):(this.removeBtnIcon("fullscreen","normalscreen"),this.setBtnInactive("fullscreen"),this.opts.fullscreen=!1,e(window).unbind("resize",e.proxy(this.fullScreenResize,this)),e(document.body).css("overflow",""),t=this.getCode(),this.$box.removeClass("redactor_box_fullscreen").css("width","auto"),this.tmpspan.after(this.$box).remove(),this.$editor=this.enable(t),this.observeImages(),this.observeTables(),this.opts.autoresize&&this.observeAutoResize(),this.$box.find(".redactor_resizer").show(),
e(this.doc).click(e.proxy(this.hideAllDropDown,this)),this.observeFocus(),this.syncCode(),this.$frame.css("height",this.height),this.$el.css("height",this.height),this.focus())},fullScreenResize:function(){if(this.opts.fullscreen===!1)return!1;var t=e(window).height()-42;this.$box.width(e(window).width()-2),this.$frame.height(t),this.$el.height(t)},buildResizer:function(){if(this.opts.resize===!1)return!1;this.$resizer=e('<div class="redactor_resizer">&mdash;</div>'),this.$box.append(this.$resizer),this.$resizer.mousedown(e.proxy(this.initResize,this))},initResize:function(t){t.preventDefault&&t.preventDefault(),this.splitter=t.target,this.opts.visual?(this.element_resize=this.$frame,this.element_resize.get(0).style.visibility="hidden",this.element_resize_parent=this.$el):(this.element_resize=this.$el,this.element_resize_parent=this.$frame),this.stopResizeHdl=e.proxy(this.stopResize,this),this.startResizeHdl=e.proxy(this.startResize,this),this.resizeHdl=e.proxy(this.resize,this),e(document).mousedown(this.startResizeHdl),e(document).mouseup(this.stopResizeHdl),e(this.splitter).mouseup(this.stopResizeHdl),this.null_point=!1,this.h_new=!1,this.h=this.element_resize.height()},startResize:function(){e(document).mousemove(this.resizeHdl)},resize:function(e){e.preventDefault&&e.preventDefault();var t=e.pageY;this.null_point===!1&&(this.null_point=t),this.h_new===!1&&(this.h_new=this.element_resize.height());var n=this.h_new+t-this.null_point-10;if(n<=30)return!0;n>=0&&(this.element_resize.get(0).style.height=n+"px",this.element_resize_parent.get(0).style.height=n+"px")},stopResize:function(t){e(document).unbind("mousemove",this.resizeHdl),e(document).unbind("mousedown",this.startResizeHdl),e(document).unbind("mouseup",this.stopResizeHdl),e(this.splitter).unbind("mouseup",this.stopResizeHdl),this.element_resize.get(0).style.visibility="visible"},resizeImage:function(t){var n=!1,r=!1,i,s,o=e(t).width()/e(t).height(),u=1,a=1,f=1,l=1;e(t).hover(function(){e(t).css("cursor","nw-resize")},function(){e(t).css("cursor","default"),n=!1}),e(t).mousedown(function(o){o.preventDefault&&o.preventDefault(),n=!0,r=!0,i=Math.round(o.pageX-e(t).eq(0).offset().left),s=Math.round(o.pageY-e(t).eq(0).offset().top)}),e(t).mouseup(e.proxy(function(e){n=!1,this.syncCode(),this.opts.autoresize===!0&&this.setAutoSize(!1)},this)),e(t).click(e.proxy(function(e){r&&this.imageEdit(e)},this)),e(t).mousemove(function(c){if(n){r=!1;var h=Math.round(c.pageX-e(this).eq(0).offset().left)-i,p=Math.round(c.pageY-e(this).eq(0).offset().top)-s,d=e(t).height(),v=parseInt(d,10)+p,m=v*o;(a===1||typeof a=="number"&&m<a&&m>f)&&e(t).width(m),(u===1||typeof u=="number"&&v<u&&v>l)&&e(t).height(v),i=Math.round(c.pageX-e(this).eq(0).offset().left),s=Math.round(c.pageY-e(this).eq(0).offset().top)}})},showTable:function(){this.modalInit(RLANG.table,"table",300,e.proxy(function(){e("#redactor_insert_table_btn").click(e.proxy(this.insertTable,this))},this),function(){e("#redactor_table_rows").focus()})},insertTable:function(){var t=e("#redactor_table_rows").val(),n=e("#redactor_table_columns").val(),r=e("<div></div>"),i=Math.floor(Math.random()*99999),s=e('<table id="table'+i+'"><tbody></tbody></table>');for(var o=0;o<t;o++){var u=e("<tr></tr>");for(var a=0;a<n;a++){var f=e("<td>&nbsp;</td>");e(u).append(f)}e(s).append(u)}e(r).append(s);var l=e(r).html();e.support.msie?l+="<p></p>":l+="<p>&nbsp;</p>",this.execCommand("inserthtml",l),this.modalClose(),this.$table=e(this.doc).find("body").find("#table"+i),this.$table.click(e.proxy(this.tableObserver,this)),this.opts.autoresize===!0&&this.setAutoSize(!1)},tableObserver:function(t){this.$table=e(t.target).parents("table"),this.$table_tr=this.$table.find("tr"),this.$table_td=this.$table.find("td"),this.$table_td.removeClass("current"),this.$tbody=e(t.target).parents("tbody"),this.$thead=e(this.$table).find("thead"),this.$current_td=e(t.target),this.$current_td.addClass("current"),this.$current_tr=e(t.target).parents("tr")},deleteTable:function(){e(this.$table).remove(),this.$table=!1,this.syncCode()},deleteRow:function(){e(this.$current_tr).remove(),this.syncCode()},deleteColumn:function(){var t=e(this.$current_td).get(0).cellIndex;e(this.$table).find("tr").each(function(){e(this).find("td").eq(t).remove()}),this.syncCode()},addHead:function(){if(e(this.$table).find("thead").size()!==0)this.deleteHead();else{var t=e(this.$table).find("tr").first().clone();t.find("td").html("&nbsp;"),this.$thead=e("<thead></thead>"),this.$thead.append(t),e(this.$table).prepend(this.$thead),this.syncCode()}},deleteHead:function(){e(this.$thead).remove(),this.$thead=!1,this.syncCode()},insertRowAbove:function(){this.insertRow("before")},insertRowBelow:function(){this.insertRow("after")},insertColumnLeft:function(){this.insertColumn("before")},insertColumnRight:function(){this.insertColumn("after")},insertRow:function(t){var n=e(this.$current_tr).clone();n.find("td").html("&nbsp;"),t==="after"?e(this.$current_tr).after(n):e(this.$current_tr).before(n),this.syncCode()},insertColumn:function(t){var n=0;this.$current_td.addClass("current"),this.$current_tr.find("td").each(function(t,r){e(r).hasClass("current")&&(n=t)}),this.$table_tr.each(function(r,i){var s=e(i).find("td").eq(n),o=s.clone();o.html("&nbsp;"),t==="after"?e(s).after(o):e(s).before(o)}),this.syncCode()},showVideo:function(){e.support.msie&&this.markerIE(),this.modalInit(RLANG.video,"video",600,e.proxy(function(){e("#redactor_insert_video_btn").click(e.proxy(this.insertVideo,this))},this),function(){e("#redactor_insert_video_area").focus()})},insertVideo:function(){var t=e("#redactor_insert_video_area").val();t=this.stripTags(t),e.support.msie?(e(this.doc.getElementById("span"+this.spanid)).after(t).remove(),this.syncCode()):this.execCommand("inserthtml",t),this.modalClose(),this.opts.autoresize===!0&&this.setAutoSize(!1)},imageEdit:function(t){var n=e(t.target),r=n.parent(),i=e.proxy(function(){e("#redactor_file_alt").val(n.attr("alt")),e("#redactor_image_edit_src").attr("href",n.attr("src")),e("#redactor_form_image_align").val(n.css("float")),e(r).get(0).tagName==="A"&&e("#redactor_file_link").val(e(r).attr("href")),e("#redactor_image_delete_btn").click(e.proxy(function(){this.imageDelete(n)},this)),e("#redactorSaveBtn").click(e.proxy(function(){this.imageSave(n)},this))},this);this.modalInit(RLANG.image,"image_edit",380,i)},imageDelete:function(t){e(t).remove(),this.modalClose(),this.syncCode(),this.opts.autoresize===!0&&this.setAutoSize(!1)},imageSave:function(t){var n=e(t).parent();e(t).attr("alt",e("#redactor_file_alt").val());var r=e("#redactor_form_image_align").val();r==="left"?e(t).css({"float":"left",margin:"0 10px 10px 0"}):r==="right"?e(t).css({"float":"right",margin:"0 0 10px 10px"}):e(t).css({"float":"none",margin:"0"});var i=e.trim(e("#redactor_file_link").val());i!==""?e(n).get(0).tagName!=="A"?e(t).replaceWith('<a href="'+i+'">'+this.outerHTML(t)+"</a>"):e(n).attr("href",i):e(n).get(0).tagName==="A"&&e(n).replaceWith(this.outerHTML(t)),this.modalClose(),this.observeImages(),this.syncCode()},showImage:function(){e.support.msie&&this.markerIE();var t=e.proxy(function(){this.opts.imageGetJson!==!1?e.getJSON(this.opts.imageGetJson,e.proxy(function(t){e.each(t,e.proxy(function(t,n){var r=e('<img src="'+n.thumb+'" rel="'+n.image+'" />');e("#redactor_image_box").append(r),e(r).click(e.proxy(this.imageSetThumb,this))},this))},this)):e("#redactor_tabs a").eq(1).remove();if(this.opts.imageUpload!==!1)this.isMobile()===!1&&e("#redactor_file").size()!==0&&e("#redactor_file").dragupload({url:this.opts.imageUpload,success:e.proxy(this.imageUploadCallback,this)}),this.uploadInit("redactor_file",{auto:!0,url:this.opts.imageUpload,success:e.proxy(this.imageUploadCallback,this)});else{e(".redactor_tab").hide();if(this.opts.imageGetJson===!1)e("#redactor_tabs").remove(),e("#redactor_tab3").show();else{var t=e("#redactor_tabs a");t.eq(0).remove(),t.eq(1).addClass("redactor_tabs_act"),e("#redactor_tab2").show()}}e("#redactor_upload_btn").click(e.proxy(this.imageUploadCallbackLink,this))},this),n=e.proxy(function(){this.opts.imageUpload===!1&&this.opts.imageGetJson===!1&&e("#redactor_file_link").focus()},this);this.modalInit(RLANG.image,"image",570,t,n,!0)},imageSetThumb:function(t){this._imageSet('<img alt="" src="'+e(t.target).attr("rel")+'" />',!0)},imageUploadCallbackLink:function(){if(e("#redactor_file_link").val()!==""){var t='<img src="'+e("#redactor_file_link").val()+'" />';this._imageSet(t,!0)}else this.modalClose()},imageUploadCallback:function(e){this._imageSet(e)},_imageSet:function(t,n){var r="",i="";n!==!0?(i=e.parseJSON(t),r='<p><img src="'+i.filelink+'" /></p>'):r=t,this.focus(),e.support.msie?(e(this.doc.getElementById("span"+this.spanid)).after(r).remove(),this.syncCode()):this.execCommand("inserthtml",r),n!==!0&&typeof this.opts.imageUploadCallback=="function"&&this.opts.imageUploadCallback(this,i),this.modalClose(),e(this.doc).find("img").load(e.proxy(function(){this.setAutoSize(!1)},this)),this.observeImages()},showLink:function(){var t=e.proxy(function(){var t=this.getSelection(),n="",r="";if(e.support.msie){var i=this.getParentNode();if(i.nodeName==="A")this.insert_link_node=e(i),r=this.insert_link_node.text(),n=this.insert_link_node.attr("href");else{this.oldIE()?r=t.text:r=t.toString(),this.spanid=Math.floor(Math.random()*99999);var s='<span id="span'+this.spanid+'">'+r+"</span>";r!==""&&(s='<span id="span'+this.spanid+'">'+r+"</span>"),this.execCommand("inserthtml",s)}}else t&&t.anchorNode&&t.anchorNode.parentNode.tagName==="A"?(n=t.anchorNode.parentNode.href,r=t.anchorNode.parentNode.text,t.toString()===""&&(this.insert_link_node=t.anchorNode.parentNode)):(r=t.toString(),n="");e(".redactor_link_text").val(r);var o=n.replace(top.location.href,"");n.search("mailto:")===0?(this.setModalTab(2),e("#redactor_tab_selected").val(2),e("#redactor_link_mailto").val(n.replace("mailto:",""))):o.search(/^#/gi)===0?(this.setModalTab(3),e("#redactor_tab_selected").val(3),e("#redactor_link_anchor").val(o.replace(/^#/gi,""))):e("#redactor_link_url").val(n),e("#redactor_insert_link_btn").click(e.proxy(this.insertLink,this))},this),n=function(t){e("#redactor_link_url").focus()};this.modalInit(RLANG.link,"link",460,t,n)},insertLink:function(){var t=e("#redactor_tab_selected").val(),n="",r="";t==="1"?(n=e("#redactor_link_url").val(),r=e("#redactor_link_url_text").val()):t==="2"?(n="mailto:"+e("#redactor_link_mailto").val(),r=e("#redactor_link_mailto_text").val()):t==="3"&&(n="#"+e("#redactor_link_anchor").val(),r=e("#redactor_link_anchor_text").val()),this._insertLink('<a href="'+n+'">'+r+"</a> ",e.trim(r),n)},_insertLink:function(t,n,r){n!=""&&(this.insert_link_node?(e(this.insert_link_node).text(n),e(this.insert_link_node).attr("href",r),this.syncCode()):e.support.msie?(e(this.doc.getElementById("span"+this.spanid)).replaceWith(t),this.syncCode()):this.execCommand("inserthtml",t)),this.modalClose()},showFile:function(){e.support.msie&&this.markerIE();var t=e.proxy(function(){var t=this.getSelection(),n="";this.oldIE()?n=t.text:n=t.toString(),e("#redactor_filename").val(n),this.isMobile()===!1&&e("#redactor_file").dragupload({url:this.opts.fileUpload,success:e.proxy(function(e){this.fileUploadCallback(e)},this)}),this.uploadInit("redactor_file",{auto:!0,url:this.opts.fileUpload,success:e.proxy(function(e){this.fileUploadCallback(e)},this)})},this);this.modalInit(RLANG.file,"file",500,t)},fileUploadCallback:function(t){var n=e.parseJSON(t),r=e("#redactor_filename").val();r===""&&(r=n.filename);var i='<a href="'+n.filelink+'">'+r+"</a>";e.support.webkit&&!!window.chrome&&(i+="&nbsp;"),e.support.msie?(r!==""?e(this.doc.getElementById("span"+this.spanid)).replaceWith(i):e(this.doc.getElementById("span"+this.spanid)).after(i).remove(),this.syncCode()):this.execCommand("inserthtml",i),typeof this.opts.fileUploadCallback=="function"&&this.opts.fileUploadCallback(this,n),this.modalClose()},modalInit:function(t,n,r,i,s,o){e("#redactor_modal_overlay").size()===0&&(this.overlay=e('<div id="redactor_modal_overlay" style="display: none;"></div>'),e("body").prepend(this.overlay)),this.opts.overlay&&(e("#redactor_modal_overlay").show(),e("#redactor_modal_overlay").click(e.proxy(this.modalClose,this))),e("#redactor_modal").size()===0&&(this.modal=e('<div id="redactor_modal" style="display: none;"><div id="redactor_modal_close">&times;</div><div id="redactor_modal_header"></div><div id="redactor_modal_inner"></div></div>'),e("body").append(this.modal)),e("#redactor_modal_close").click(e.proxy(this.modalClose,this)),this.hdlModalClose=e.proxy(function(e){e.keyCode===27&&this.modalClose()},this),e(document).keyup(this.hdlModalClose),e(this.doc).keyup(this.hdlModalClose),e("#redactor_modal_inner").html(this.opts["modal_"+n]),e("#redactor_modal_header").html(t);if(e("#redactor_tabs").size()!==0){var u=this;e("#redactor_tabs a").each(function(t,n){t++,e(n).click(function(){e("#redactor_tabs a").removeClass("redactor_tabs_act"),e(this).addClass("redactor_tabs_act"),e(".redactor_tab").hide(),e("#redactor_tab"+t).show(),e("#redactor_tab_selected").val(t);if(u.isMobile()===!1){var n=e("#redactor_modal").outerHeight();e("#redactor_modal").css("margin-top","-"+(n+10)/2+"px")}})})}e("#redactor_btn_modal_close").click(e.proxy(this.modalClose,this)),typeof i=="function"&&i();var a=e("#redactor_modal").outerHeight();this.isMobile()===!1?e("#redactor_modal").css({position:"fixed",top:"50%",left:"50%",width:r+"px",height:"auto",marginTop:"-"+(a+10)/2+"px",marginLeft:"-"+(r+60)/2+"px"}).fadeIn("fast"):(e("#redactor_modal").css({position:"absolute",width:"96%",height:"auto",top:"20px",left:"0",marginTop:"0px",marginLeft:"2%"}).show(),this.scrolltop()),typeof s=="function"&&s(),o===!0&&e("#redactor_image_box").height(300).css("overflow","auto")},modalClose:function(){e("#redactor_modal_close").unbind("click",this.modalClose),e("#redactor_modal").fadeOut("fast",e.proxy(function(){e("#redactor_modal_inner").html(""),this.opts.overlay&&(e("#redactor_modal_overlay").hide(),e("#redactor_modal_overlay").unbind("click",this.modalClose)),e(document).unbind("keyup",this.hdlModalClose),e(this.doc).unbind("keyup",this.hdlModalClose)},this))},setModalTab:function(t){e(".redactor_tab").hide();var n=e("#redactor_tabs a");n.removeClass("redactor_tabs_act"),n.eq(t-1).addClass("redactor_tabs_act"),e("#redactor_tab"+t).show()},uploadInit:function(t,n){this.uploadOptions={url:!1,success:!1,start:!1,trigger:!1,auto:!1,input:!1},e.extend(this.uploadOptions,n),e("#"+t).size()!==0&&e("#"+t).get(0).tagName==="INPUT"?(this.uploadOptions.input=e("#"+t),this.element=e(e("#"+t).get(0).form)):this.element=e("#"+t),this.element_action=this.element.attr("action"),this.uploadOptions.auto?e(this.uploadOptions.input).change(e.proxy(function(){this.element.submit(function(e){return!1}),this.uploadSubmit()},this)):this.uploadOptions.trigger&&e("#"+this.uploadOptions.trigger).click(e.proxy(this.uploadSubmit,this))},uploadSubmit:function(){this.uploadForm(this.element,this.uploadFrame())},uploadFrame:function(){this.id="f"+Math.floor(Math.random()*99999);var t=document.createElement("div"),n='<iframe style="display:none" src="about:blank" id="'+this.id+'" name="'+this.id+'"></iframe>';return t.innerHTML=n,document.body.appendChild(t),this.uploadOptions.start&&this.uploadOptions.start(),e("#"+this.id).load(e.proxy(this.uploadLoaded,this)),this.id},uploadForm:function(t,n){if(this.uploadOptions.input){var r="redactorUploadForm"+this.id,i="redactorUploadFile"+this.id;this.form=e('<form  action="'+this.uploadOptions.url+'" method="POST" target="'+n+'" name="'+r+'" id="'+r+'" enctype="multipart/form-data"></form>');var s=this.uploadOptions.input,o=e(s).clone();e(s).attr("id",i),e(s).before(o),e(s).appendTo(this.form),e(this.form).css("position","absolute"),e(this.form).css("top","-2000px"),e(this.form).css("left","-2000px"),e(this.form).appendTo("body"),this.form.submit()}else t.attr("target",n),t.attr("method","POST"),t.attr("enctype","multipart/form-data"),t.attr("action",this.uploadOptions.url),this.element.submit()},uploadLoaded:function(){var t=e("#"+this.id),n;t.contentDocument?n=t.contentDocument:t.contentWindow?n=t.contentWindow.document:n=window.frames[this.id].document;if(n.location.href==="about:blank")return!0;if(this.uploadOptions.success){var r=n.body.innerHTML,i=r.match(/\{.*\}/)[0];this.uploadOptions.success(i)}this.element.attr("action",this.element_action),this.element.attr("target","")},markerIE:function(){this.spanid=Math.floor(Math.random()*99999),this.execCommand("inserthtml",'<span id="span'+this.spanid+'"></span>')},oldIE:function(){return e.support.msie&&parseInt(e.support.version,10)<9?!0:!1},outerHTML:function(t){return e("<p>").append(e(t).eq(0).clone()).html()},normalize:function(e){return parseInt(e.replace("px",""),10)},isMobile:function(){return/(iPhone|iPod|iPad|BlackBerry|Android)/.test(navigator.userAgent)?!0:!1},scrolltop:function(){e("html,body").animate({scrollTop:0},500)}},e.fn.getDoc=function(){return e(this.data("redactor").doc)},e.fn.getFrame=function(){return this.data("redactor").$frame},e.fn.getEditor=function(){return this.data("redactor").$editor},e.fn.getCode=function(){return this.data("redactor").getCode()},e.fn.getText=function(){return this.data("redactor").$editor.text()},e.fn.setCode=function(e){this.data("redactor").setCode(e)},e.fn.insertHtml=function(e){this.data("redactor").insertHtml(e)},e.fn.destroyEditor=function(){this.data("redactor").destroy(),this.removeData("redactor")},e.fn.setFocus=function(){this.data("redactor").focus()},e.fn.execCommand=function(e,t){this.data("redactor").execCommand(e,t)}})(jQuery),function(e){"use strict";function t(t,n){this.opts=e.extend({url:!1,success:!1,preview:!1,text:RLANG.drop_file_here,atext:RLANG.or_choose},n),this.$el=e(t)}e.fn.dragupload=function(e){return this.each(function(){var n=new t(this,e);n.init()})},t.prototype={init:function(){if(!e.support.opera&&!e.support.msie){this.droparea=e('<div class="redactor_droparea"></div>'),this.dropareabox=e('<div class="redactor_dropareabox">'+this.opts.text+"</div>"),this.dropalternative=e('<div class="redactor_dropalternative">'+this.opts.atext+"</div>"),this.droparea.append(this.dropareabox),this.$el.before(this.droparea),this.$el.before(this.dropalternative),this.dropareabox.bind("dragover",e.proxy(function(){return this.ondrag()},this)),this.dropareabox.bind("dragleave",e.proxy(function(){return this.ondragleave()},this));var t=e.proxy(function(e){var t=parseInt(e.loaded/e.total*100,10);this.dropareabox.text("Loading "+t+"%")},this),n=jQuery.ajaxSettings.xhr();n.upload&&n.upload.addEventListener("progress",t,!1);var r=function(){return n};this.dropareabox.get(0).ondrop=e.proxy(function(t){t.preventDefault(),this.dropareabox.removeClass("hover").addClass("drop");var n=t.dataTransfer.files[0],i=new FormData;i.append("file",n),e.ajax({dataType:"html",url:this.opts.url,data:i,xhr:r,cache:!1,contentType:!1,processData:!1,type:"POST",success:e.proxy(function(e){this.opts.success!==!1&&this.opts.success(e),this.opts.preview===!0&&this.dropareabox.html(e)},this)})},this)}},ondrag:function(){return this.dropareabox.addClass("hover"),!1},ondragleave:function(){return this.dropareabox.removeClass("hover"),!1}}}(jQuery),function(e){"use strict";var t=/(^|&lt;|\s)(www\..+?\..+?)(\s|&gt;|$)/g,n=/(^|&lt;|\s)(((https?|ftp):\/\/|mailto:).+?)(\s|&gt;|$)/g,r=function(){var i=this.childNodes,s=i.length;while(s--){var o=i[s];if(o.nodeType===3){var u=o.nodeValue;u&&(u=u.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(t,'$1<a href="http://$2">$2</a>$3').replace(n,'$1<a href="$2">$2</a>$5'),e(o).after(u).remove())}else o.nodeType===1&&!/^(a|button|textarea)$/i.test(o.tagName)&&r.call(o)}};e.fn.linkify=function(){this.each(r)}}(jQuery);