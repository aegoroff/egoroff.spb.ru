{% extends 'base.html' %}

# block scripts
  <script>
  $(function() {
    $( "#accordion" ).accordion({
      collapsible: true,
      heightStyle: "content"
    });
  });
  </script>
# endblock

{% block head %}
    <link type="text/css" rel='stylesheet' href="/p/css/jquery-ui-1.10.3.custom.min.css">
{% endblock %}


{% block content %}

    <div class="row-fluid">
        <div class="span9">
            {% if not posts %}
                Ничего нет
            {% else %}
                <dl id="blog">
                    {% for post in posts.object_list %}
                        {% include 'news/post_box.html' %}
                    {% endfor %}
                </dl>
            {% endif %}

            {% if posts.paginator.num_pages > 1 %}

                {% if "tag" in request.args %}
                    {% set tag_query = "?tag=" + request.args["tag"] %}
                {% else %}
                    {% set tag_query = "" %}
                {% endif %}
                <ul class="pager">
                    {% if posts.has_previous %}
                        <li class="previous">
                            <a href="{{ url_for(
                                'news.index',
                                page=posts.previous_page_number) }}{{ tag_query }}"
                               class="prev">
                                &larr; новее
                            </a>
                        </li>
                    {% else %}
                        <li class="disabled previous">
                            <a href="#">&larr; новее</a>
                        </li>
                    {% endif %}

                    {% if posts.has_next %}
                        <li class="next">
                            <a href="{{ url_for('news.index', page=posts.next_page_number) }}{{ tag_query }}"
                               class="next">старее &rarr;</a>
                        </li>
                    {% else %}
                        <li class="next disabled">
                            <a href="#"
                               class="next">старее &rarr;</a>
                        </li>
                    {% endif %}
                </ul>
                <div class="pagination">
                    <ul style="float: left;">
                        {% for page in posts.paginator.page_range %}
                            {% if page %}
                                {% if page == posts.number %}
                                    <li class="active">
                                        <a href="{{ url_for('news.index', page=page) }}{{ tag_query }}"
                                           class="page">{{ page }}</a>
                                    </li>
                                {% else %}
                                    <li>
                                        <a href="{{ url_for('news.index', page=page) }}{{ tag_query }}"
                                           class="page">{{ page }}</a>
                                    </li>
                                {% endif %}
                            {% else %}
                                ......
                            {% endif %}
                        {% endfor %}
                    </ul>
                </div>
            {% endif %}
        </div>
        <div class="span3">
            <h3>Метки</h3>
            <div class="tags">
            {% if not tags %}
                <p>Ничего нет</p>
            {% else %}
                {% for tag in tags %}
                    <a href="{{ url_for('news.index') }}?tag={{ tag.title }}"
                       class={{ tag.tag_level }}>{{ tag.title }}</a>
                {% endfor %}
            {% endif %}
            </div>
            <h3>Архив</h3>
            {% if not archieve %}
                <p>Ничего нет</p>
            {% else %}
                <div id="accordion">
                    {% for year in archieve | sort(reverse=True) %}
                        <h3>{{ year }}</h3>
                        <div>
                            <ul class="nav nav-list">
                            {% for month in archieve[year] %}
                                <li><a href="#year={{ year }}&month={{ month[0] }}"
                                        >{{ months[month[0]] }} ({{ month[1] }})</a></li>
                            {% endfor %}
                            </ul>
                        </div>
                    {% endfor %}
                </div>
            {% endif %}
        </div>
    </div>
{% endblock %}