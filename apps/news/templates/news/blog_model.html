<script id="blog" type="text/html">
    <dt>
        <small>
            <i class="icon-calendar"></i> <span class="shortDateFormat" data-bind="text: created"></span>
        </small>&nbsp;
        <!-- ko ifnot: id() == '{{ main_post.key.id() }}' -->
        <a data-bind="text: title, attr: { href: '{{ url_for('news.index') }}' + id() + '.html'  }"></a>
        <!-- /ko -->
        <!-- ko if: id() == '{{ main_post.key.id() }}' -->
        <span data-bind="text: title"></span>
        <!-- /ko -->
    </dt>
    <dd data-bind="html: short_text"></dd>
</script>

<script>
    function BlogViewModel() {
        var self = this;

        this.blogPosts = ko.mapping.fromJS([]);

        this.getPosts = function(limit, offset) {
            service_call('get', '/api/v2/posts.json', { "offset": offset, "limit": limit }, function(data) {
                self.successfullyRetrievedPosts(data.result);
            });
        };

        this.successfullyRetrievedPosts = function(posts) {
            ko.mapping.fromJS(posts, self.blogPosts);
        };

        this.postProcessingLogic = function(elements) {
            $(elements).each(function(idx, elem) {
                formatElementWith($(elem).find("span.shortDateFormat"), 'LL');
            });
        }
    }

    vm = new BlogViewModel();
    vm.getPosts({{ limit }},{{ offset }});
    ko.applyBindings(vm);

</script>